# 派生列の定義
# この設定ファイルで、既存の列から新しい列を動的に生成できます

derived_columns:
  # エリア分類の例
  - name: "エリア分類"
    description: "首都圏のエリア分類（東京23区、三多摩島しょ、埼玉県、神奈川県、千葉県、その他）"
    calculation_type: "rules"  # ルールベースの分類
    source_columns:
      - "都道府県"
      - "市区町村"

    rules:
      # 東京23区
      - label: "東京23区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with_any"
            values:
              - "千代田区"
              - "中央区"
              - "港区"
              - "新宿区"
              - "文京区"
              - "台東区"
              - "墨田区"
              - "江東区"
              - "品川区"
              - "目黒区"
              - "大田区"
              - "世田谷区"
              - "渋谷区"
              - "中野区"
              - "杉並区"
              - "豊島区"
              - "北区"
              - "荒川区"
              - "板橋区"
              - "練馬区"
              - "足立区"
              - "葛飾区"
              - "江戸川区"

      # 三多摩島しょ
      - label: "三多摩島しょ"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"

      # 埼玉県
      - label: "埼玉県"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "埼玉県"

      # 神奈川県
      - label: "神奈川県"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "神奈川県"

      # 千葉県
      - label: "千葉県"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "千葉県"

      # その他
      - label: "その他"
        is_default: true

  # 学年の計算
  - name: "学年"
    description: "生年月日から算出した学年（2025年度基準）"
    calculation_type: "grade_from_birthdate"  # 学年計算専用
    source_columns:
      - "生年月日"

    parameters:
      target_year: 2025          # 対象年度
      birthdate_column: "生年月日"  # 生年月日列名

  # 学校種別の計算
  - name: "学校種別"
    description: "生年月日から算出した学校種別（小学生・中学生・その他、2025年度基準）"
    calculation_type: "school_type_from_birthdate"  # 学校種別計算専用
    source_columns:
      - "生年月日"

    parameters:
      target_year: 2025          # 対象年度
      birthdate_column: "生年月日"  # 生年月日列名
      labels:
        elementary: "小学生"      # 小学生のラベル（省略可、デフォルト: "小学生"）
        junior_high: "中学生"     # 中学生のラベル（省略可、デフォルト: "中学生"）
        other: "その他"           # その他のラベル（省略可、デフォルト: "その他"）

  # 複数列の統合（merge）の例
  - name: "各校のブースで知りたい内容を順に３つまで選んでください"
    description: "複数の順位選択列を統合した派生列（複数回答として扱われます）"
    calculation_type: "merge"  # 複数列を統合
    source_columns:
      - "各校のブースで1番知りたい内容を選んでください"
      - "各校のブースで2番目に知りたい内容を選んでください"
      - "各校のブースで3番目に知りたい内容を選んでください"

    parameters:
      separator: "|||"  # 結合時のセパレータ（デフォルト: "|||"）

  # 東京23区
  - name: "東京23区"
    description: "東京23区を区ごとに判定（千代田区、中央区、港区、新宿区...）"
    calculation_type: "rules"
    source_columns:
      - "都道府県"
      - "市区町村"

    rules:
      # 千代田区
      - label: "千代田区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "千代田区"

      # 中央区
      - label: "中央区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "中央区"

      # 港区
      - label: "港区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "港区"

      # 新宿区
      - label: "新宿区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "新宿区"

      # 文京区
      - label: "文京区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "文京区"

      # 台東区
      - label: "台東区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "台東区"

      # 墨田区
      - label: "墨田区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "墨田区"

      # 江東区
      - label: "江東区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "江東区"

      # 品川区
      - label: "品川区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "品川区"

      # 目黒区
      - label: "目黒区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "目黒区"

      # 大田区
      - label: "大田区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "大田区"

      # 世田谷区
      - label: "世田谷区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "世田谷区"

      # 渋谷区
      - label: "渋谷区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "渋谷区"

      # 中野区
      - label: "中野区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "中野区"

      # 杉並区
      - label: "杉並区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "杉並区"

      # 豊島区
      - label: "豊島区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "豊島区"

      # 北区
      - label: "北区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "北区"

      # 荒川区
      - label: "荒川区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "荒川区"

      # 板橋区
      - label: "板橋区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "板橋区"

      # 練馬区
      - label: "練馬区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "練馬区"

      # 足立区
      - label: "足立区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "足立区"

      # 葛飾区
      - label: "葛飾区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "葛飾区"

      # 江戸川区
      - label: "江戸川区"
        conditions:
          - column: "都道府県"
            operator: "equals"
            value: "東京都"
          - column: "市区町村"
            operator: "starts_with"
            value: "江戸川区"

      # その他
      - label: "その他"
        is_default: true
